men <- beauty_data %>% filter(female!=1)
women <- beauty_data %>% filter(female==1)
looks_men_1 <- lm(log(wage)~belavg+abvavg+educ+exper+I(exper^2)+union+goodhlth+black+married+south+bigcity+smllcity+service, data=men)
coefficients_men_1 <- coef(summary(looks_men_1))
kable(coefficients_men_1)
looks_women_1 <- lm(log(wage)~belavg+abvavg+educ+exper+I(exper^2)+union+goodhlth+black+married+south+bigcity+smllcity+service, data=women)
coefficients_women_1 <- coef(summary(looks_women_1))
kable(coefficients_women_1)
vif
?vif
knitr::opts_chunk$set(dev = 'png',tidy.opts=list(width.cutoff=60),tidy=TRUE)
library(tidyverse)
library(knitr)
library(car)
setwd("~/Grad School/2021-01 Spring/IA 530 - Econometrics-Ind Study/Exam_2")
# import data
vote_data <- read_csv("VOTE1.csv")
school_data <- read_csv("ELEM94_95.csv")
homePrice_data <- read_csv("KIELMC.csv")
beauty_data <- read_csv("BEAUTY.csv")
# set alpha level
alpha <- 0.05
vote_1_model <- lm(voteA ~ log(expendA)+log(expendB)+prtystrA, data=vote_data)
coefficients_vote_1 <- coef(summary(vote_1_model))
kable(coefficients_vote_1)
school_model_1 <- lm(lavgsal ~ bs, data=school_data)
coefficients_school_1 <- coef(summary(school_model_1))
kable(coefficients_school_1)
old_value = exp(predict(school_model_1, newdata=data.frame(bs=c(1))))
new_value = exp(predict(school_model_1, newdata=data.frame(bs=c(2))))
(new_value-old_value)/old_value
# calculate the confidence interval
lower_bound <- coefficients_school_1['bs', 'Estimate']-
qt(1-alpha/2,nrow(school_data))*coefficients_school_1['bs', 'Std. Error']
upper_bound <- coefficients_school_1['bs', 'Estimate']+
qt(1-alpha/2,nrow(school_data))*coefficients_school_1['bs', 'Std. Error']
c(lower_bound, upper_bound)
school_model_2 <- lm(lavgsal ~ bs+lenrol+lstaff, data=school_data)
coefficients_school_2 <- coef(summary(school_model_2))
kable(coefficients_school_2)
old_value = exp(predict(school_model_2, newdata=data.frame(bs=c(1),
lenrol=c(log(1)),
lstaff=c(log(1)))))
new_value = exp(predict(school_model_2, newdata=data.frame(bs=c(1),
lenrol=c(log(1.01)),
lstaff=c(log(1)))))
(new_value-old_value)/old_value
new_value = exp(predict(school_model_2, newdata=data.frame(bs=c(1),
lenrol=c(log(1)),
lstaff=c(log(1.01)))))
(new_value-old_value)/old_value
kable(cor(school_data %>% select(bs,lenrol,lstaff)))
old_value = exp(predict(school_model_2, newdata=data.frame(bs=c(0.2),
lenrol=c(log(1000)),
lstaff=c(log(100)))))
new_value = exp(predict(school_model_2, newdata=data.frame(bs=c(0.2),
lenrol=c(log(1000)),
lstaff=c(log(101)))))
# check percent decrease is the same for 1% increase
(new_value-old_value)/old_value
(new_value-old_value)
school_model_3 <- lm(lavgsal ~ bs+lenrol+lstaff+lunch, data=school_data)
coefficients_school_3 <- coef(summary(school_model_3))
kable(coefficients_school_3)
old_value = exp(predict(school_model_3, newdata=data.frame(bs=c(1),
lenrol=c(log(1)),
lstaff=c(log(1)),
lunch=c(1))))
new_value = exp(predict(school_model_3, newdata=data.frame(bs=c(1),
lenrol=c(log(1)),
lstaff=c(log(1)),
lunch=c(2))))
# check percent decrease is the same for 1% increase
(new_value-old_value)/old_value
price_model_1 <- lm(lprice ~ ldist, data=homePrice_data)
coefficients_price_1 <- coef(summary(price_model_1))
kable(coefficients_price_1)
price_model_2 <- lm(lprice ~ ldist+log(intst)+log(area)+log(land)+rooms+baths+age, data=homePrice_data)
coefficients_price_2 <- coef(summary(price_model_2))
kable(coefficients_price_2)
cor(homePrice_data %>% select(ldist, lintst, larea, lland, rooms, baths, age))
price_model_3 <- lm(lprice ~ ldist+log(intst)+log(area)+log(land)+rooms+baths+age+I(log(intst)^2), data=homePrice_data)
coefficients_price_3 <- coef(summary(price_model_3))
kable(coefficients_price_3)
beauty_data <- beauty_data %>%
mutate(gender=if_else(female==1,'women','men'),
looks_cat=case_when(abvavg==1 ~ 'AboveAvg',
belavg==1 ~ 'BelowAvg',
TRUE ~ 'Avg'))
beauty_data_summary <- beauty_data %>%
group_by(gender, looks_cat) %>%
summarize(count=n())
beauty_data_summary <- beauty_data_summary %>%
group_by(gender) %>%
mutate(percent_gender = count/sum(count)*100) %>%
ungroup() %>%
mutate(percent_all = count/sum(count)*100)
kable(beauty_data_summary)
men <- beauty_data %>% filter(female!=1)
women <- beauty_data %>% filter(female==1)
looks_men_1 <- lm(log(wage)~belavg+abvavg, data=men)
coefficients_men_1 <- coef(summary(looks_men_1))
kable(coefficients_men_1)
looks_women_1 <- lm(log(wage)~belavg+abvavg, data=women)
coefficients_women_1 <- coef(summary(looks_women_1))
kable(coefficients_women_1)
old_value = exp(predict(looks_men_1, newdata=data.frame(belavg=c(0),abvavg=c(0))))
new_value = exp(predict(looks_men_1, newdata=data.frame(bs=c(0.2),
lenrol=c(log(1000)),
lstaff=c(log(101)))))
log(1.01)
1/100
library(tidyverse)
library(lubridate)
library(here)
library(janitor)
library(foreign)
setwd("~/Grad School/2021-01 Spring/IA 530 - Econometrics-Ind Study/ia530_final_project/R Code")
library(tidyverse)
library(lubridate)
library(here)
library(janitor)
library(foreign)
test <- read.xport(here('Data', 'brfss', 'CDBRFS00.XPT'))
View(test)
names(test)
sort(names(test))
View(test)
list.files(here('Data','brfss'))
brfss_files <- list.files(here('Data','brfss'))
brfss_files <- list.files(here('Data','brfss'))
for(i in brfss_files){
i
}
for(i in brfss_files){
print(i)
}
brfss_files <- list.files(here('Data','brfss'))
for(i in brfss_files){
temp_file <- read.xport(i)
temp_file_2 <- temp_file %>%
select(IMONTH, MARITAL, MENHLTH, GENHLTH) %>%
group_by(IMONTH, MARITAL, MENHLTH, GENHLTH) %>%
summarize(count=n())
break
}
brfss_files <- list.files(here('Data','brfss'))
for(i in brfss_files){
temp_file <- read.xport(here('Data','brfss',i))
temp_file_2 <- temp_file %>%
select(IMONTH, MARITAL, MENHLTH, GENHLTH) %>%
group_by(IMONTH, MARITAL, MENHLTH, GENHLTH) %>%
summarize(count=n())
break
}
for(i in brfss_files){
temp_file <- read.xport(here('Data','brfss',i))
temp_file_2 <- temp_file %>%
select(IMONTH, MARITAL, MENTHLTH, GENHLTH) %>%
group_by(IMONTH, MARITAL, MENTHLTH, GENHLTH) %>%
summarize(count=n())
break
}
View(temp_file_2)
for(i in brfss_files){
temp_file <- read.xport(here('Data','brfss',i))
year <- gsub('[A-Z]', '', i)
print(year)
temp_file_2 <- temp_file %>%
select(IMONTH, MARITAL, MENTHLTH, GENHLTH) %>%
group_by(IMONTH, MARITAL, MENTHLTH, GENHLTH) %>%
summarize(count=n()) %>%
mutate(YEAR=year)
break
}
View(temp_file_2)
for(i in brfss_files){
temp_file <- read.xport(here('Data','brfss',i))
year <- gsub('[[:digit:] | [:punct:]]', '', i)
print(year)
temp_file_2 <- temp_file %>%
select(IMONTH, MARITAL, MENTHLTH, GENHLTH) %>%
group_by(IMONTH, MARITAL, MENTHLTH, GENHLTH) %>%
summarize(count=n()) %>%
mutate(YEAR=year)
break
}
year <- gsub('[[:alpha:] | [:punct:]]', '', i)
for(i in brfss_files){
temp_file <- read.xport(here('Data','brfss',i))
year <- gsub('[[:alpha:] | [:punct:]]', '', i)
print(year)
temp_file_2 <- temp_file %>%
select(IMONTH, MARITAL, MENTHLTH, GENHLTH) %>%
group_by(IMONTH, MARITAL, MENTHLTH, GENHLTH) %>%
summarize(count=n()) %>%
mutate(YEAR=year)
break
}
for(i in brfss_files){
temp_file <- read.xport(here('Data','brfss',i))
year <- gsub('[[:alpha:] | [:punct:]]', '', i)
if(length(year)!=4){
year <- paste('20',year,sep='')
}
print(year)
temp_file_2 <- temp_file %>%
select(IMONTH, MARITAL, MENTHLTH, GENHLTH) %>%
group_by(IMONTH, MARITAL, MENTHLTH, GENHLTH) %>%
summarize(count=n()) %>%
mutate(YEAR=year)
break
}
year <- as.numeric(paste('20',year,sep=''))
for(i in brfss_files){
temp_file <- read.xport(here('Data','brfss',i))
year <- gsub('[[:alpha:] | [:punct:]]', '', i)
if(length(year)!=4){
year <- as.numeric(paste('20',year,sep=''))
}
print(year)
temp_file_2 <- temp_file %>%
select(IMONTH, MARITAL, MENTHLTH, GENHLTH) %>%
group_by(IMONTH, MARITAL, MENTHLTH, GENHLTH) %>%
summarize(count=n()) %>%
mutate(YEAR=year)
break
}
for(i in brfss_files){
temp_file <- read.xport(here('Data','brfss',i))
year <- gsub('[[:alpha:] | [:punct:]]', '', i)
if(length(year)!=4){
year <- as.numeric(paste('20',year,sep=''))
}
print(year)
temp_file_2 <- temp_file %>%
select(IMONTH, MARITAL, MENTHLTH, GENHLTH) %>%
group_by(IMONTH, MARITAL, MENTHLTH, GENHLTH) %>%
summarize(count = n()) %>%
mutate(YEAR = year,
month_end = rollback(ceiling_date(ymd(paste(as.character(YEAR),IMONTH, '01')),unit='month')))
break
}
all_data <- NA
all_data <- NA
for(i in brfss_files){
temp_file <- read.xport(here('Data','brfss',i))
year <- gsub('[[:alpha:] | [:punct:]]', '', i)
if(length(year)!=4){
year <- as.numeric(paste('20',year,sep=''))
}
print(year)
temp_file_2 <- temp_file %>%
select(IMONTH, MARITAL, MENTHLTH, GENHLTH) %>%
group_by(IMONTH, MARITAL, MENTHLTH, GENHLTH) %>%
summarize(count = n()) %>%
mutate(YEAR = year,
month_end = rollback(ceiling_date(ymd(paste(as.character(YEAR),IMONTH, '01')),unit='month'))) %>%
clean_names()
all_data <- bind_rows(all_data, temp_file_2)
break
}
View(temp_file_2)
names(temp_file_2)
all_data <- tibble()
for(i in brfss_files){
temp_file <- read.xport(here('Data','brfss',i))
year <- gsub('[[:alpha:] | [:punct:]]', '', i)
if(length(year)!=4){
year <- as.numeric(paste('20',year,sep=''))
}
print(year)
temp_file_2 <- temp_file %>%
select(IMONTH, MARITAL, MENTHLTH, GENHLTH) %>%
group_by(IMONTH, MARITAL, MENTHLTH, GENHLTH) %>%
summarize(count = n()) %>%
mutate(YEAR = year,
month_end = rollback(ceiling_date(ymd(paste(as.character(YEAR),IMONTH, '01')),unit='month'))) %>%
clean_names()
all_data <- bind_rows(all_data, temp_file_2)
break
}
View(all_data)
library(tidyverse)
library(lubridate)
library(here)
library(janitor)
library(foreign)
brfss_files <- list.files(here('Data','brfss'))
all_data <- tibble()
for(i in brfss_files){
temp_file <- read.xport(here('Data','brfss',i))
year <- gsub('[[:alpha:] | [:punct:]]', '', i)
if(length(year)!=4){
year <- as.numeric(paste('20',year,sep=''))
}
print(year)
temp_file_2 <- temp_file %>%
select(IMONTH, MARITAL, MENTHLTH, GENHLTH) %>%
group_by(IMONTH, MARITAL, MENTHLTH, GENHLTH) %>%
summarize(count = n()) %>%
mutate(YEAR = year,
month_end = rollback(ceiling_date(ymd(paste(as.character(YEAR),IMONTH, '01')),unit='month'))) %>%
clean_names()
all_data <- bind_rows(all_data, temp_file_2)
}
brfss_files <- list.files(here('Data','brfss'))
brfss_files
gsub('[[:alpha:] | [:punct:]]', '', "LLCP2015.XPT")
length(gsub('[[:alpha:] | [:punct:]]', '', "LLCP2015.XPT"))
nchar(gsub('[[:alpha:] | [:punct:]]', '', "LLCP2015.XPT"))
library(tidyverse)
library(lubridate)
library(here)
library(janitor)
library(foreign)
brfss_files <- list.files(here('Data','brfss'))
all_data <- tibble()
for(i in brfss_files){
temp_file <- read.xport(here('Data','brfss',i))
year <- gsub('[[:alpha:] | [:punct:]]', '', i)
if(nchar(year)!=4){
year <- as.numeric(paste('20',year,sep=''))
}
print(year)
temp_file_2 <- temp_file %>%
select(IMONTH, MARITAL, MENTHLTH, GENHLTH) %>%
group_by(IMONTH, MARITAL, MENTHLTH, GENHLTH) %>%
summarize(count = n()) %>%
mutate(YEAR = year,
month_end = rollback(ceiling_date(ymd(paste(as.character(YEAR),IMONTH, '01')),unit='month'))) %>%
clean_names()
all_data <- bind_rows(all_data, temp_file_2)
}
library(tidyverse)
library(lubridate)
library(here)
library(janitor)
library(foreign)
brfss_files <- list.files(here('Data','brfss'))
all_data <- tibble()
for(i in brfss_files){
temp_file <- read.xport(here('Data','brfss',i))
year <- gsub('[[:alpha:] | [:punct:]]', '', i)
if(nchar(year)!=4){
if(as.numeric(year)>=50){
year <- as.numeric(paste('19',year,sep=''))
} else{
year <- as.numeric(paste('20',year,sep=''))
}
} else {
year <- as.numeric(year)
}
print(year)
temp_file_2 <- temp_file %>%
select(IMONTH, MARITAL, MENTHLTH, GENHLTH) %>%
group_by(IMONTH, MARITAL, MENTHLTH, GENHLTH) %>%
summarize(count = n()) %>%
mutate(YEAR = year,
month_end = rollback(ceiling_date(ymd(paste(as.character(YEAR),IMONTH, '01')),unit='month'))) %>%
clean_names()
all_data <- bind_rows(all_data, temp_file_2)
}
View(all_data)
write_csv(all_data, 'all_brfss_data.csv')
write_csv(all_data, here('Data','all_brfss_data.csv'))
View(all_data)
setwd("~/Grad School/2021-01 Spring/IA 530 - Econometrics-Ind Study/ia530_final_project/R Code")
library(tidyverse)
library(lubridate)
library(here)
library(janitor)
library(tidyverse)
library(lubridate)
library(here)
library(janitor)
brfss_data <- read_csv(here('Data','all_brfss_data.csv'))
brfss_codes <- read_csv(here('Data','brfss_codes.csv'))
View(brfss_codes)
brfss_codes <- read_csv(here('Data','brfss_codes.csv'))
brfss_data %>% select(marital) %>% unique()
brfss_codes <- read_csv(here('Data','brfss_codes.csv')) %>%
clean_names()
View(brfss_data)
brfss_data <- brfss_data %>%
left_join(brfss_codes %>% filter(variable_name=='MARITAL') %>% select(value, value_name), by=c('marital'='value'))
brfss_data <- brfss_data %>%
left_join(brfss_codes %>% filter(variable_name=='MARITAL') %>% select(value, value_label), by=c('marital'='value'))
View(brfss_data)
?left_join
brfss_data <- read_csv(here('Data','all_brfss_data.csv'))
brfss_codes <- read_csv(here('Data','brfss_codes.csv')) %>%
clean_names()
brfss_data <- brfss_data %>%
left_join(brfss_codes %>% filter(variable_name=='MARITAL') %>% select(value, value_label), by=c('marital'='value')) %>%
left_join(brfss_codes %>% filter(variable_name=='GENHLTH') %>% select(value, value_label), by=c('genhlth'='value'), suffix=c('_marital','_genhlth'))
brfss_data <- read_csv(here('Data','all_brfss_data.csv'))
brfss_codes <- read_csv(here('Data','brfss_codes.csv')) %>%
clean_names()
brfss_data <- brfss_data %>%
left_join(brfss_codes %>% filter(variable_name=='MARITAL') %>% select(value, value_label), by=c('marital'='value')) %>%
left_join(brfss_codes %>% filter(variable_name=='GENHLTH') %>% select(value, value_label), by=c('genhlth'='value'), suffix=c('_marital','_genhlth')) %>%
left_join(brfss_codes %>% filter(variable_name=='MENTHLTH') %>% select(value, value_label), by=c('menthlth'='value')) %>%
rename(value_label = value_label_menthlth)
?rename
brfss_data <- brfss_data %>%
left_join(brfss_codes %>% filter(variable_name=='MARITAL') %>% select(value, value_label), by=c('marital'='value')) %>%
left_join(brfss_codes %>% filter(variable_name=='GENHLTH') %>% select(value, value_label), by=c('genhlth'='value'), suffix=c('_marital','_genhlth')) %>%
left_join(brfss_codes %>% filter(variable_name=='MENTHLTH') %>% select(value, value_label), by=c('menthlth'='value')) %>%
rename(value_label_menthlth = value_label)
unique(brfss_data$value_label_menthlth)
is.numeric('4')
grep('[[:digit:]]','233res')
grepl('[[:digit:]]','233res')
grepl('[[:digit:]]',NA)
brfss_data <- brfss_data %>%
mutate(value_label_menthlth_cond = if_else(grepl('[[:digit:]]',value_label_menthlth),'Mental Health Not Good Last 30 Days',value_label_menthlth))
unique(brfss_data$value_label_menthlth)
unique(brfss_data$value_label_menthlth_cond)
test <- brfss_data %>%
group_by(value_label_menthlth_cond) %>%
summarize(count=sum(count))
View(test)
brfss_data <- brfss_data %>%
mutate(value_label_menthlth_cond = if_else(grepl('[[:digit:]]',value_label_menthlth),'Mntl Health Not Good','Mental Health Good/No Answer'))
unique(brfss_data$value_label_genhlth)
unique(brfss_data$value_label_marital)
brfss_data <- brfss_data %>%
mutate(value_label_menthlth_cond = if_else(grepl('[[:digit:]]',value_label_menthlth),'Mntl Health Not Good','Mental Health Good/No Answer'),
value_label_marital_cond = if_else(value_label_marital %in% c('Divorced', 'Widowed', 'Separated'),'Divorced/Widowed/Separated','Married/NeverMarried/MemberOfUnmarriedCouple'),
value_label_genhlth_cond = if_else(value_label_genhlth %in% c('Poor'),'Poor Gen Health','Good Gen Health/No Answer'))
ment_health <- brfss_data %>%
select(month_end, value_label_menthlth_cond, count) %>%
group_by(month_end, value_label_menthlth_cond, count) %>%
summarize(count=sum(count)) %>%
group_by(month_end) %>%
mutate(percent=count/sum(count))
View(ment_health)
ment_health <- brfss_data %>%
select(month_end, value_label_menthlth_cond, count) %>%
group_by(month_end, value_label_menthlth_cond) %>%
summarize(count=sum(count)) %>%
group_by(month_end) %>%
mutate(percent=count/sum(count))
ment_health <- brfss_data %>%
select(month_end, value_label_menthlth_cond, count) %>%
group_by(month_end, value_label_menthlth_cond) %>%
summarize(count=sum(count)) %>%
group_by(month_end) %>%
mutate(percent=count/sum(count)) %>%
filter(value_label_menthlth_cond!='Mental Health Good/No Answer') %>%
select(month_end, percent)
ment_health_no_good <- brfss_data %>%
select(month_end, value_label_menthlth_cond, count) %>%
group_by(month_end, value_label_menthlth_cond) %>%
summarize(count=sum(count)) %>%
group_by(month_end) %>%
mutate(percent=count/sum(count)) %>%
filter(value_label_menthlth_cond!='Mental Health Good/No Answer') %>%
select(month_end, percent)
?year
View(brfss_data)
test <- brfss_data %>%
filter(year==2002) %>%
group_by(ment_health) %>%
summarize(total=sum(count))
test <- brfss_data %>%
filter(year==2002) %>%
group_by(menthlth) %>%
summarize(total=sum(count))
View(test)
brfss_data <- brfss_data %>%
filter(!is.na(ment_health)) %>%
mutate(value_label_menthlth_cond = if_else(grepl('[[:digit:]]',value_label_menthlth),'Mntl Health Not Good','Mental Health Good/No Answer'),
value_label_marital_cond = if_else(value_label_marital %in% c('Divorced', 'Widowed', 'Separated'),'Divorced/Widowed/Separated','Married/NeverMarried/MemberOfUnmarriedCouple'),
value_label_genhlth_cond = if_else(value_label_genhlth %in% c('Poor'),'Poor Gen Health','Good Gen Health/No Answer'))
brfss_data <- brfss_data %>%
filter(!is.na(menthlth)) %>%
mutate(value_label_menthlth_cond = if_else(grepl('[[:digit:]]',value_label_menthlth),'Mntl Health Not Good','Mental Health Good/No Answer'),
value_label_marital_cond = if_else(value_label_marital %in% c('Divorced', 'Widowed', 'Separated'),'Divorced/Widowed/Separated','Married/NeverMarried/MemberOfUnmarriedCouple'),
value_label_genhlth_cond = if_else(value_label_genhlth %in% c('Poor'),'Poor Gen Health','Good Gen Health/No Answer'))
View(brfss_data)
ment_health_no_good <- brfss_data %>%
select(month_end, value_label_menthlth_cond, count) %>%
group_by(month_end, value_label_menthlth_cond) %>%
summarize(count=sum(count)) %>%
group_by(month_end) %>%
mutate(percent=count/sum(count)) %>%
filter(value_label_menthlth_cond!='Mental Health Good/No Answer') %>%
select(month_end, percent)
View(ment_health_no_good)
ggplot2(ment_health_no_good, aes(x=month_end, y=percent)) + geom_line()
library(ggplot2)
ggplot2(ment_health_no_good, aes(x=month_end, y=percent)) + geom_line()
ggplot(ment_health_no_good, aes(x=month_end, y=percent)) + geom_line()
test <- ment_health_no_good %>%
mutate(month=month(month_end))  %>%
group_by(month) %>%
summarize(avg=mean(percent))
View(test)
test <- ment_health_no_good %>%
mutate(month=month(month_end))  %>%
group_by(month) %>%
summarize(avg=mean(percent),sd=sd(percent))
ggplot(test, aes(x=month,y=avg)) %>%
geom_point() +
geom_line() +
geom_errorbar(aes(ymin=avg-sd,ymax=avg+sd))
ggplot(test, aes(x=month,y=avg)) +
geom_point() +
geom_line() +
geom_errorbar(aes(ymin=avg-sd,ymax=avg+sd))
